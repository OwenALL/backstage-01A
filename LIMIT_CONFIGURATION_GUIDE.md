# 限红配置功能使用指南

**版本**: V2.1  
**更新日期**: 2025-12-01  
**生产环境**: https://webapp-eqp.pages.dev/

---

## 功能概述

限红配置是风控管理系统的核心功能，用于设置不同游戏的投注限额，有效控制风险敞口。通过创建多个限红组，可以针对不同的玩家群体（如VIP会员、普通会员）设置差异化的投注限额。

---

## 功能特性

### 1. 限红组管理

#### ✅ 创建限红组
- **入口**: 风控管理 → 限红配置 → 点击"新增限红组"
- **必填信息**:
  - 组名称：如"VIP会员限红组"、"普通玩家限红组"
  - 各游戏限额配置
- **可选信息**:
  - 描述：说明此限红组的适用范围
  - 状态：启用/禁用

#### 📝 支持的游戏类型
1. **百家乐** 🎲
   - 最小/最大投注额
   - 默认：¥10 - ¥50,000

2. **龙虎** 🐉
   - 最小/最大投注额
   - 默认：¥10 - ¥30,000

3. **轮盘** 🎡
   - 最小/最大投注额
   - 默认：¥5 - ¥20,000

4. **骰宝** 🎲
   - 最小/最大投注额
   - 默认：¥5 - ¥10,000

5. **牛牛** 🐄
   - 最小/最大投注额
   - 默认：¥10 - ¥20,000

#### ✏️ 编辑限红组
- **入口**: 点击限红组卡片右上角的"编辑"图标
- **可修改内容**:
  - 组名称
  - 描述
  - 状态（启用/禁用）
  - 各游戏的最小/最大投注额

#### ⏸️ 启用/禁用限红组
- **功能**: 快速切换限红组的启用状态
- **操作**: 点击限红组卡片右上角的"暂停/播放"图标
- **说明**: 禁用后，使用此限红组的玩家将恢复默认限额

#### 🗑️ 删除限红组
- **操作**: 点击限红组卡片右上角的"删除"图标
- **安全检查**: 
  - 如有玩家或桌台正在使用，将阻止删除
  - 显示具体使用数量，提示先解绑
- **确认提示**: 需要二次确认，避免误操作

---

## 界面说明

### 限红组卡片显示内容

每个限红组卡片包含以下信息：

```
┌─────────────────────────────────────┐
│ 🟢 VIP会员限红组                     │ [编辑] [暂停] [删除]
│ 适用于VIP等级3级以上的会员           │
├─────────────────────────────────────┤
│ 🎲 百家乐    ¥100 - ¥100,000        │
│ 🐉 龙虎      ¥100 - ¥80,000         │
│ 🎡 轮盘      ¥50 - ¥50,000          │
│ 🎲 骰宝      ¥50 - ¥30,000          │
│ 🐄 牛牛      ¥100 - ¥50,000         │
├─────────────────────────────────────┤
│ 👥 绑定玩家: 127  🎲 绑定桌台: 8     │
└─────────────────────────────────────┘
```

### 状态指示器

- 🟢 **绿色圆点**: 限红组已启用
- ⚫ **灰色圆点**: 限红组已禁用
- 📊 **使用统计**: 显示当前有多少玩家和桌台使用此限红组

---

## API 接口文档

### 获取限红组列表
```
GET /api/risk/limit-groups
```

**响应示例**:
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "group_name": "VIP会员限红组",
      "description": "适用于VIP等级3级以上",
      "baccarat_limits": "{\"min\":100,\"max\":100000}",
      "dragon_tiger_limits": "{\"min\":100,\"max\":80000}",
      "roulette_limits": "{\"min\":50,\"max\":50000}",
      "sicbo_limits": "{\"min\":50,\"max\":30000}",
      "niuniu_limits": "{\"min\":100,\"max\":50000}",
      "status": 1,
      "player_count": 127,
      "table_count": 8,
      "created_at": "2025-12-01 10:30:00",
      "updated_at": "2025-12-01 14:20:00"
    }
  ]
}
```

### 获取单个限红组
```
GET /api/risk/limit-groups/:id
```

### 创建限红组
```
POST /api/risk/limit-groups
```

**请求体示例**:
```json
{
  "group_name": "普通玩家限红组",
  "description": "适用于普通会员",
  "baccarat_limits": "{\"min\":10,\"max\":50000}",
  "dragon_tiger_limits": "{\"min\":10,\"max\":30000}",
  "roulette_limits": "{\"min\":5,\"max\":20000}",
  "sicbo_limits": "{\"min\":5,\"max\":10000}",
  "niuniu_limits": "{\"min\":10,\"max\":20000}",
  "status": 1
}
```

### 更新限红组
```
PUT /api/risk/limit-groups/:id
```

**请求体**: 同创建接口（可部分更新）

### 删除限红组
```
DELETE /api/risk/limit-groups/:id
```

**说明**: 如有玩家或桌台使用，将返回错误并提示具体数量

---

## 最佳实践

### 1. 限红组设计建议

#### 按玩家等级划分
```
- 新手玩家限红组 (¥10 - ¥5,000)
- 普通玩家限红组 (¥10 - ¥50,000)
- VIP玩家限红组 (¥100 - ¥200,000)
- 超级VIP限红组 (¥500 - ¥500,000)
```

#### 按游戏风险划分
```
- 低风险游戏组 (轮盘、骰宝)
- 中风险游戏组 (龙虎、牛牛)
- 高风险游戏组 (百家乐)
```

### 2. 风险控制建议

#### 设置合理的限额比例
- 最小投注额：防止恶意高频小额投注
- 最大投注额：控制单笔风险敞口
- 建议比例：最大投注额 = 最小投注额 × 100-1000

#### 动态调整策略
- 监控玩家投注行为
- 根据盈亏情况调整限额
- 特殊时段（如节假日）适当提高限额

### 3. 操作注意事项

#### ⚠️ 删除前检查
- 查看"绑定玩家"和"绑定桌台"数量
- 如有使用，先解除绑定再删除
- 重要限红组建议禁用而非删除

#### 💡 修改生效时间
- 限红组修改后立即生效
- 影响所有绑定此限红组的玩家和桌台
- 重要调整建议在低峰时段进行

---

## 使用场景示例

### 场景1：新建VIP会员限红组

1. **创建限红组**
   - 名称：VIP高额玩家组
   - 描述：适用于VIP等级5级以上，单次充值≥10万
   
2. **设置游戏限额**
   - 百家乐：¥500 - ¥200,000
   - 龙虎：¥500 - ¥150,000
   - 轮盘：¥200 - ¥100,000
   - 骰宝：¥200 - ¥80,000
   - 牛牛：¥500 - ¥100,000

3. **启用并绑定**
   - 状态设为"启用"
   - 在玩家管理中将符合条件的VIP玩家绑定到此限红组

### 场景2：临时调整限额

**背景**: 春节期间，为了吸引玩家，临时提高限额

1. **编辑现有限红组**
   - 选择"普通玩家限红组"
   - 点击编辑按钮

2. **提高最大投注额**
   - 百家乐：从¥50,000提高到¥80,000
   - 龙虎：从¥30,000提高到¥50,000
   - 其他游戏相应提高20%-30%

3. **活动结束后恢复**
   - 再次编辑限红组
   - 将限额恢复到原来的设置

### 场景3：风险玩家限制

**背景**: 发现某玩家有套利嫌疑，需要降低其投注限额

1. **创建限制性限红组**
   - 名称：风险控制限红组
   - 描述：用于限制高风险玩家

2. **设置较低限额**
   - 所有游戏：¥10 - ¥5,000
   - 严格控制最大投注额

3. **绑定风险玩家**
   - 在玩家管理中将该玩家的限红组改为此限制组
   - 密切监控其后续行为

---

## 技术规格

### 数据库表结构

```sql
CREATE TABLE IF NOT EXISTS limit_groups (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  group_name TEXT NOT NULL,
  description TEXT,
  baccarat_limits TEXT,        -- JSON格式: {"min":10,"max":50000}
  dragon_tiger_limits TEXT,     -- JSON格式
  roulette_limits TEXT,         -- JSON格式
  sicbo_limits TEXT,            -- JSON格式
  niuniu_limits TEXT,           -- JSON格式
  status INTEGER DEFAULT 1,     -- 1=启用, 0=禁用
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

### 关联关系

- **玩家表 (players)**: 通过 `limit_group_id` 字段关联
- **游戏桌台表 (game_tables)**: 通过 `limit_group_id` 字段关联

---

## 常见问题

### Q1: 删除限红组时提示"正在使用"怎么办？
**A**: 需要先解除所有玩家和桌台的绑定：
1. 到"玩家管理"中查找使用此限红组的玩家
2. 将这些玩家改为其他限红组
3. 到"桌台管理"中修改桌台的限红组设置
4. 完成解绑后即可删除

### Q2: 修改限红组后多久生效？
**A**: 立即生效。所有使用此限红组的玩家和桌台将立即应用新的限额设置。

### Q3: 可以为单个玩家设置特殊限额吗？
**A**: 可以通过以下方式：
1. 创建专门的限红组（如"特殊玩家组"）
2. 设置该玩家专属的限额
3. 仅将该玩家绑定到此限红组

### Q4: 限红组数量有限制吗？
**A**: 理论上没有数量限制，但建议：
- 保持在10个以内，便于管理
- 按玩家等级或游戏类型合理分类
- 避免创建过多相似的限红组

### Q5: 禁用和删除有什么区别？
**A**: 
- **禁用**: 暂时停用，数据保留，可随时重新启用
- **删除**: 永久删除，数据无法恢复（需先解除所有绑定）

---

## 更新日志

### V2.1 (2025-12-01)
- ✅ 完全重构限红配置UI界面
- ✅ 新增限红组的完整CRUD操作
- ✅ 添加使用统计显示（绑定玩家/桌台数）
- ✅ 实现模态框编辑功能
- ✅ 增强后端API（GET/PUT/DELETE单个限红组）
- ✅ 添加删除前的安全检查
- ✅ 优化用户交互体验

---

## 支持信息

- **生产环境**: https://webapp-eqp.pages.dev/
- **系统总管理后台**: https://webapp-eqp.pages.dev/
- **代理管理后台**: https://webapp-eqp.pages.dev/agent.html
- **联系邮箱**: cnwen123@gmail.com
- **GitHub仓库**: 
  - 主仓库: https://github.com/CNWEN123/backstage-01A
  - 备份仓库: https://github.com/CNWEN123/Live-dealer-backstage-01

---

© 2025 真人荷官视讯系统. All Rights Reserved.
