# 运营级管理后台功能规划（待开发清单）

**版本**: V2.2 规划版  
**基于文档**: 《运营级管理后台（Admin Panel / CMS）》+ 《运营级真人视讯管理后台》  
**当前系统版本**: V2.1  
**规划日期**: 2025-12-01

---

## 📋 文档说明

本文档对照两份参考资料，分析当前真人荷官视讯系统后台管理平台（V2.1）已有功能，列出**尚未完善的运营级功能**，供决策和后续开发参考。

**标注说明**:
- ✅ **已实现** - 当前系统V2.1已有
- 🔶 **部分实现** - 有基础功能但不完善
- ❌ **未实现** - 需要新开发
- 🚫 **暂不需要** - 不适用于当前业务场景

---

## 一、效率类功能：让运营「快」起来

### 1. 高级批量操作 (Advanced Batch Actions)

#### 1.1 批量状态变更
| 功能点 | 状态 | 当前实现 | 待完善内容 |
|--------|------|----------|------------|
| 批量上架/下架 | 🔶 | 有单个启用/禁用 | **待开发**: 批量选择多个记录，一键批量启用/禁用 |
| 批量审核通过/拒绝 | 🔶 | 提款/洗码有单个审核 | **待开发**: 勾选多条待审核记录，批量通过或拒绝 |
| 批量封禁/解封 | ❌ | 无 | **待开发**: 批量冻结/解冻玩家账户 |

**优先级**: 🔥🔥🔥 高  
**理由**: 运营日常处理大量审核和状态管理，批量操作可大幅提效

**实现建议**:
```javascript
// 在列表页添加全选/反选功能
- 表头增加全选checkbox
- 每行增加选择checkbox
- 选中后显示批量操作按钮栏：
  [批量启用] [批量禁用] [批量审核通过] [批量拒绝] [批量导出]
```

#### 1.2 批量修改属性
| 功能点 | 状态 | 当前实现 | 待完善内容 |
|--------|------|----------|------------|
| 批量调整洗码方案 | ❌ | 只能单个设置 | **待开发**: 选择多个玩家，统一设置洗码方案 |
| 批量调整VIP等级 | ❌ | 只能单个设置 | **待开发**: 批量升级或降级VIP等级 |
| 批量转移代理 | ❌ | 只能单个转移 | **待开发**: 批量将玩家从代理A转移到代理B |
| 批量设置限红组 | ❌ | 只能单个设置 | **待开发**: 批量给玩家分配限红组 |

**优先级**: 🔥🔥 中  
**理由**: 批量属性修改在活动推广或批量调整策略时非常有用

#### 1.3 批量导入/导出
| 功能点 | 状态 | 当前实现 | 待完善内容 |
|--------|------|----------|------------|
| Excel/CSV 批量导入 | ❌ | 无 | **待开发**: 支持批量导入玩家、代理、白名单等 |
| 导入错误预检 | ❌ | 无 | **待开发**: 上传前验证格式，提示哪一行有错误 |
| 自定义字段导出 | 🔶 | 有导出但不能选字段 | **待开发**: 勾选需要导出的字段，按需导出 |
| 导出大数据集 | ❌ | 无 | **待开发**: 支持异步导出，超过1万条数据生成下载链接 |

**优先级**: 🔥🔥 中  
**理由**: 批量导入/导出在系统迁移、批量营销、数据分析时必不可少

**实现建议**:
```javascript
// 导入功能
- 提供Excel/CSV模板下载
- 上传文件后进行格式验证
- 显示预检结果（成功/失败行数）
- 确认后批量入库

// 导出功能
- 在列表页添加"自定义导出"按钮
- 弹出字段选择器，勾选需要的字段
- 支持导出当前筛选条件下的数据
- 超过1万条异步处理，生成下载链接
```

---

### 2. 超级筛选与搜索 (Advanced Filtering & Search)

#### 2.1 组合筛选
| 功能点 | 状态 | 当前实现 | 待完善内容 |
|--------|------|----------|------------|
| 多条件组合筛选 | 🔶 | 有基础筛选 | **待开发**: 支持"并且/或者"逻辑组合 |
| 高级筛选器 | ❌ | 无 | **待开发**: 可视化筛选条件构建器 |
| 保存筛选条件 | ❌ | 无 | **待开发**: 将常用筛选条件保存为"视图" |

**优先级**: 🔥🔥 中  
**实现示例**:
```javascript
// 高级筛选界面
筛选条件组1 (并且):
  - 注册时间：[本月]
  - 消费金额：[大于 1000]
  - VIP等级：[≥ 3]
[并且/或者]
筛选条件组2 (并且):
  - 最后登录：[7天内]
  - 状态：[启用]

[保存为常用视图: "活跃高价值用户"]
```

#### 2.2 ID/模糊搜索增强
| 功能点 | 状态 | 当前实现 | 待完善内容 |
|--------|------|----------|------------|
| 精准ID搜索 | ✅ | 支持 | 无 |
| 模糊名称搜索 | ✅ | 支持 | 无 |
| 多ID批量搜索 | ❌ | 无 | **待开发**: 粘贴多个ID（逗号分隔），批量查询 |
| 智能搜索联想 | ❌ | 无 | **待开发**: 输入时自动联想匹配结果 |

**优先级**: 🔥 低

#### 2.3 快捷视图（Tab）
| 功能点 | 状态 | 当前实现 | 待完善内容 |
|--------|------|----------|------------|
| 状态Tab快捷筛选 | ✅ | 已有（如"待审核/已通过"） | 可扩展更多场景 |
| 自定义Tab | ❌ | 无 | **待开发**: 运营可自定义常用Tab |

**优先级**: 🔥 低

---

### 3. 模拟与预览 (Emulation & Preview)

#### 3.1 内容预览
| 功能点 | 状态 | 当前实现 | 待完善内容 |
|--------|------|----------|------------|
| Banner/公告预览 | 🚫 | 不适用 | 系统无前端CMS功能 |
| 活动页面预览 | 🚫 | 不适用 | 系统无活动页面管理 |

**优先级**: 🚫 暂不需要（系统无内容管理模块）

#### 3.2 用户视角模拟 (Login As)
| 功能点 | 状态 | 当前实现 | 待完善内容 |
|--------|------|----------|------------|
| 以玩家身份登录 | ❌ | 无 | **待开发**: 客服可临时切换为玩家视角排查问题 |
| 操作审计日志 | 🔶 | 有审计但不完整 | **待开发**: 记录"谁以谁的身份做了什么" |

**优先级**: 🔥 低  
**理由**: 对于排查玩家反馈的界面问题很有用，但需严格权限控制

**实现建议**:
```javascript
// 玩家详情页增加"模拟登录"按钮
- 仅超级管理员或授权客服可用
- 点击后打开新窗口，以玩家身份登录前端
- 所有操作记录到审计日志
- 30分钟后自动退出模拟
```

---

## 二、流程与控制类功能：让运营「稳」起来

### 4. 审核流工作台 (Audit Workflow)

#### 4.1 任务分发
| 功能点 | 状态 | 当前实现 | 待完善内容 |
|--------|------|----------|------------|
| 自动分配待审核任务 | ❌ | 手动审核 | **待开发**: 根据规则自动分配给不同运营人员 |
| 任务认领机制 | ❌ | 无 | **待开发**: 运营主动认领待审核任务 |

**优先级**: 🔥 低  
**理由**: 中小团队手动处理即可，大团队才需要自动分配

#### 4.2 快捷反馈
| 功能点 | 状态 | 当前实现 | 待完善内容 |
|--------|------|----------|------------|
| 拒绝原因模版 | ❌ | 手动输入原因 | **待开发**: 常用拒绝原因快速选择（如"身份证模糊"） |
| 常用话术库 | ❌ | 无 | **待开发**: 预设审核通过/拒绝的标准话术 |

**优先级**: 🔥🔥 中  
**实现建议**:
```javascript
// 拒绝提款时弹出快捷选择
拒绝原因：
  [ ] 身份证照片模糊
  [ ] 银行卡信息不符
  [ ] 流水不足
  [ ] 可疑账户
  [自定义原因]
```

#### 4.3 历史比对
| 功能点 | 状态 | 当前实现 | 待完善内容 |
|--------|------|----------|------------|
| 显示历史违规记录 | ❌ | 无 | **待开发**: 审核时显示该用户历史违规情况 |
| 关联账户提示 | ❌ | 无 | **待开发**: 提示相同IP/设备的其他账户 |

**优先级**: 🔥🔥 中  
**理由**: 帮助风控人员快速判断风险

---

### 5. 灵活配置中心 (Config Management)

#### 5.1 App 首页装修
| 功能点 | 状态 | 当前实现 | 待完善内容 |
|--------|------|----------|------------|
| 拖拽式配置 | 🚫 | 不适用 | 系统无前端CMS |
| Banner管理 | 🚫 | 不适用 | 系统无前端CMS |

**优先级**: 🚫 暂不需要（系统专注后台管理，无玩家前端装修需求）

#### 5.2 文案与参数配置
| 功能点 | 状态 | 当前实现 | 待完善内容 |
|--------|------|----------|------------|
| 系统参数配置 | ❌ | 硬编码 | **待开发**: 后台配置系统参数（如最小提款额） |
| 文案配置 | ❌ | 硬编码 | **待开发**: 配置系统提示语（如"余额不足"） |
| 客服联系方式 | ❌ | 硬编码 | **待开发**: 后台配置客服电话/微信 |

**优先级**: 🔥🔥 中  
**实现建议**:
```javascript
// 系统设置 → 参数配置
业务参数：
  - 最小充值金额：[100] 元
  - 最小提款金额：[200] 元
  - 提款手续费率：[0.5] %
  - 每日提款次数限制：[3] 次

联系方式：
  - 客服电话：[400-xxx-xxxx]
  - 客服微信：[kefu_xxx]
  - 在线客服链接：[https://...]
```

#### 5.3 开关控制
| 功能点 | 状态 | 当前实现 | 待完善内容 |
|--------|------|----------|------------|
| 功能开关 | ❌ | 无 | **待开发**: 一键开启/关闭充值、提款、游戏等功能 |
| 维护模式 | ❌ | 无 | **待开发**: 开启维护模式，显示维护公告 |

**优先级**: 🔥🔥🔥 高  
**理由**: 紧急情况下快速关闭功能非常重要

**实现建议**:
```javascript
// 系统设置 → 功能开关
功能开关：
  [√] 充值功能
  [√] 提款功能
  [√] 游戏投注
  [ ] 代理注册
  
维护模式：
  [ ] 开启维护模式
  维护公告：[系统升级中，预计2小时后恢复...]
```

---

### 6. 推送与触达 (Notification & Push)

| 功能点 | 状态 | 当前实现 | 待完善内容 |
|--------|------|----------|------------|
| 站内消息推送 | 🚫 | 不适用 | 系统无玩家前端 |
| Push通知 | 🚫 | 不适用 | 系统无玩家前端 |
| 短信通知 | ❌ | 无 | **可考虑**: 重要操作短信通知（如提款到账） |
| 邮件通知 | ❌ | 无 | **可考虑**: 审核结果邮件通知 |

**优先级**: 🔥 低（系统主要面向后台运营，非C端触达）

---

## 三、安全与风控功能：让运营「敢」操作

### 7. 操作日志 (Operation Logs) —— 核心功能

#### 7.1 全链路审计日志
| 功能点 | 状态 | 当前实现 | 待完善内容 |
|--------|------|----------|------------|
| 基础审计日志 | ✅ | 已有audit_logs表 | 功能完善 |
| 详细操作记录 | 🔶 | 部分操作有记录 | **待完善**: 确保所有敏感操作均记录 |
| 数据变更对比 | ❌ | 无 | **待开发**: 记录"从A改为B"（before/after） |
| 日志查询界面 | ❌ | 无前端界面 | **待开发**: 系统设置中增加"操作日志"查询 |

**优先级**: 🔥🔥🔥 高  
**理由**: 审计日志是追责和问题排查的唯一依据

**实现建议**:
```javascript
// 系统设置 → 操作日志
筛选条件：
  操作人：[选择管理员]
  操作模块：[玩家管理/财务管理/...]
  操作类型：[创建/修改/删除]
  时间范围：[最近7天]

日志列表：
| 时间 | 操作人 | 模块 | 操作 | 目标 | 详情 | IP地址 |
| 2025-12-01 14:30 | admin | 玩家管理 | 修改 | ID:1234 | 余额: 100→200 | 1.2.3.4 |
```

#### 7.2 操作详情展开
**待开发内容**:
- 点击日志条目，展开显示完整的before/after数据对比
- 支持导出特定时间段的审计日志
- 敏感操作（如删除）高亮显示

---

### 8. 敏感操作二次确认与回滚 (Confirmation & Rollback)

#### 8.1 高危操作保护
| 功能点 | 状态 | 当前实现 | 待完善内容 |
|--------|------|----------|------------|
| 删除二次确认 | ✅ | 已有confirm弹窗 | 功能完善 |
| 批量操作警告 | ❌ | 无 | **待开发**: 批量操作前显示影响范围 |
| 密码二次验证 | ❌ | 无 | **待开发**: 超高危操作需输入管理员密码 |
| 文字验证码 | ❌ | 无 | **待开发**: 删除时输入"确认删除"四个字 |

**优先级**: 🔥🔥 中  
**实现建议**:
```javascript
// 批量删除时
⚠️ 警告：即将删除 127 个玩家账户
此操作将影响以下数据：
  - 玩家余额将被清零
  - 所有投注记录将被标记为已删除
  - 关联的代理关系将被解除

为避免误操作，请输入以下文字确认：
[ 请输入"确认删除" ]

[取消] [确认删除]
```

#### 8.2 软删除与回收站
| 功能点 | 状态 | 当前实现 | 待完善内容 |
|--------|------|----------|------------|
| 软删除（标记废弃） | 🔶 | 部分表支持status字段 | **待统一**: 所有删除操作改为软删除 |
| 回收站功能 | ❌ | 无 | **待开发**: 可恢复30天内删除的数据 |

**优先级**: 🔥🔥 中  
**理由**: 防止误删除，提供反悔机会

---

### 9. 细粒度权限控制 (RBAC)

#### 9.1 角色权限管理
| 功能点 | 状态 | 当前实现 | 待完善内容 |
|--------|------|----------|------------|
| 角色管理 | ✅ | 有roles表 | 基础功能已实现 |
| 权限分配 | ✅ | 有permissions字段 | 基础功能已实现 |
| 数据权限隔离 | ❌ | 无 | **待开发**: 按代理线、区域隔离数据可见范围 |
| 字段级权限 | ❌ | 无 | **待开发**: 某些角色看不到敏感字段（如余额） |

**优先级**: 🔥🔥 中  
**实现建议**:
```javascript
// 角色权限配置
角色：客服专员
功能权限：
  [√] 查看玩家列表
  [√] 查看玩家详情
  [ ] 修改玩家余额
  [√] 查看订单记录
  [ ] 审核提款申请
  
数据权限：
  可见范围：[仅本人创建的工单] 或 [全部数据]
  
字段权限：
  玩家余额：[隐藏]
  银行卡号：[脱敏显示]
```

---

## 四、真人视讯垂直功能

### 10. 现场与局务管理 (Live & Game Management)

#### 10.1 异常处理与补单 (Exception Handling)
| 功能点 | 状态 | 当前实现 | 待完善内容 |
|--------|------|----------|------------|
| 改单/重结算 | ❌ | 无 | **待开发**: 手动修改开奖结果并重新结算注单 |
| 手动飞牌/作废局 | ❌ | 无 | **待开发**: 将当前局设为作废并自动退款 |
| 补单/补结算 | ❌ | 无 | **待开发**: 系统漏结算时手动触发补结算 |

**优先级**: 🔥🔥🔥 高（**真人视讯核心功能**）  
**理由**: 视频卡顿、荷官失误、传感器误判等异常情况需要快速处理

**实现建议**:
```javascript
// 注单管理 → 异常处理
搜索局号：[Round ID: 20251201-001]

局详情：
  桌台：百家乐-VIP1
  荷官：Alice
  开奖结果：庄赢
  投注总额：¥125,000
  赔付总额：¥98,000
  
操作：
  [改单重结算] - 修改开奖结果，系统自动重新计算
  [作废本局] - 所有注单作废并全额退款
  [手动补结算] - 触发补结算流程
  
⚠️ 所有操作将记录到审计日志，请谨慎操作
```

#### 10.2 视频回放与追溯 (Video Playback)
| 功能点 | 状态 | 当前实现 | 待完善内容 |
|--------|------|----------|------------|
| 局号级视频回放 | ❌ | 无 | **待开发**: 输入局号调出视频录像切片 |
| 视频截图留证 | ❌ | 无 | **待开发**: 回放时一键截图并添加水印 |
| 客诉处理流程 | ❌ | 无 | **待开发**: 从客诉工单直接跳转到视频回放 |

**优先级**: 🔥🔥🔥 高（**真人视讯核心功能**）  
**理由**: 处理玩家投诉的唯一可靠证据

**实现建议**:
```javascript
// 注单管理 → 视频回放
输入局号：[20251201-001] [搜索]

视频回放：
  [视频播放器]
  - 播放/暂停
  - 快进/快退
  - 截图按钮（生成带水印的截图）
  
局信息：
  时间：2025-12-01 14:30:25
  桌台：百家乐-VIP1
  荷官：Alice
  开奖结果：庄赢
  
截图历史：
  [截图1] - 14:30:28 - 发牌瞬间
  [截图2] - 14:30:45 - 开牌瞬间
```

#### 10.3 荷官/主播排班系统 (Dealer Scheduling)
| 功能点 | 状态 | 当前实现 | 待完善内容 |
|--------|------|----------|------------|
| 荷官管理 | ✅ | 有dealers表 | 基础功能已实现 |
| 排班日历 | ❌ | 无 | **待开发**: 日历视图展示排班，拖拽排班 |
| 台桌绑定 | ❌ | 无 | **待开发**: 设置荷官-桌台-时间段绑定 |
| 强制下线 | ❌ | 无 | **待开发**: 发现异常立即强制荷官下线 |

**优先级**: 🔥🔥 中  
**实现建议**:
```javascript
// 直播间管理 → 荷官排班

日历视图：
┌─────────┬──────────┬──────────┬──────────┐
│ 时间     │ 桌台1    │ 桌台2    │ 桌台3    │
├─────────┼──────────┼──────────┼──────────┤
│ 08:00-12:00 │ Alice   │ Bob     │ Charlie │
│ 12:00-16:00 │ David   │ Emma    │ Alice   │
│ 16:00-20:00 │ Frank   │ Grace   │ Bob     │
└─────────┴──────────┴──────────┴──────────┘

[添加排班] [导入排班] [导出排班]

荷官列表：
| 荷官ID | 姓名 | 状态 | 当前桌台 | 操作 |
| 001 | Alice | 🟢在线 | 百家乐-VIP1 | [强制下线] [查看排班] |
```

---

### 11. 风险控制与监控 (Risk Control)

#### 11.1 实时路单与限红管理 (Roadmap & Limits)
| 功能点 | 状态 | 当前实现 | 待完善内容 |
|--------|------|----------|------------|
| 限红配置 | ✅ | V2.1已完善 | 功能完整 |
| 实时路单监控 | ❌ | 无 | **待开发**: 实时显示各桌台输赢走势 |
| 杀率预警 | ❌ | 无 | **待开发**: 桌台杀率过低/过高时自动报警 |

**优先级**: 🔥🔥 中  
**实现建议**:
```javascript
// 风控管理 → 实时监控

桌台监控大屏：
┌──────────────────────────────────────┐
│ 百家乐-VIP1  杀率: 2.5% ✅正常         │
│ 路单：庄庄闲庄庄闲庄庄庄庄 [查看详情]   │
│ 当前局：进行中 | 累计投注: ¥250,000    │
└──────────────────────────────────────┘

┌──────────────────────────────────────┐
│ 龙虎-普通1  杀率: -8.3% ⚠️异常低      │
│ 路单：龙虎龙龙龙龙虎龙龙龙 [查看详情]   │
│ 当前局：结算中 | 累计投注: ¥180,000    │
│ [暂停此桌] [更换荷官]                 │
└──────────────────────────────────────┘
```

#### 11.2 套利与异常预警 (Arbitrage Detection)
| 功能点 | 状态 | 当前实现 | 待完善内容 |
|--------|------|----------|------------|
| 实时预警 | ✅ | V2.1已有 | 可扩展预警规则 |
| 对打/刷水检测 | ❌ | 无 | **待开发**: 自动识别庄闲同时下注套利 |
| 高频/大额预警 | 🔶 | 有大额预警 | **待完善**: 增加高频投注检测 |
| 同IP多账号预警 | ❌ | 无 | **待开发**: 检测同IP下多账号集中投注 |

**优先级**: 🔥🔥🔥 高  
**理由**: 防止套利和刷流水是真人视讯的核心风控需求

---

### 12. 互动与内容生态 (Interaction)

#### 12.1 聊天室净化与场控 (Chat Moderation)
| 功能点 | 状态 | 当前实现 | 待完善内容 |
|--------|------|----------|------------|
| 全局/特定禁言 | 🚫 | 暂不需要 | 系统无聊天室功能 |
| 机器人/托管理 | 🚫 | 暂不需要 | 系统无聊天室功能 |

**优先级**: 🚫 暂不需要（当前系统无聊天室模块）

#### 12.2 公告与跑马灯 (Announcements)
| 功能点 | 状态 | 当前实现 | 待完善内容 |
|--------|------|----------|------------|
| 系统公告管理 | ❌ | 无 | **待开发**: 发布系统公告或维护通知 |
| 跑马灯（滚动通知） | 🚫 | 不适用 | 系统无玩家前端 |

**优先级**: 🔥 低（后台管理系统无需跑马灯）

---

### 13. 财务与核算 (Finance & Settlement)

#### 13.1 交收报表 (Shift Reports)
| 功能点 | 状态 | 当前实现 | 待完善内容 |
|--------|------|----------|------------|
| 荷官交收报表 | ❌ | 无 | **待开发**: 记录荷官当班期间的投注/赔付/小费 |
| 桌台盈亏表 | ❌ | 无 | **待开发**: 按桌台维度查看盈亏情况 |
| 班次结算 | ❌ | 无 | **待开发**: 按班次（早/中/晚班）结算数据 |

**优先级**: 🔥🔥 中  
**实现建议**:
```javascript
// 报表中心 → 交收报表

筛选条件：
  日期：[2025-12-01]
  桌台：[百家乐-VIP1]
  班次：[早班 08:00-16:00]

荷官交收明细：
| 荷官 | 接班时间 | 交班时间 | 总投注额 | 总赔付额 | 平台盈亏 | 小费收入 |
| Alice | 08:00 | 12:00 | ¥500,000 | ¥480,000 | +¥20,000 | ¥1,200 |
| Bob   | 12:00 | 16:00 | ¥450,000 | ¥470,000 | -¥20,000 | ¥800 |

桌台盈亏汇总：
| 桌台 | 总投注 | 总赔付 | 平台盈亏 | 杀率 | 局数 |
| 百家乐-VIP1 | ¥950,000 | ¥950,000 | ±¥0 | 0% | 152 |
```

#### 13.2 礼物与打赏记录 (Gifts & Tips)
| 功能点 | 状态 | 当前实现 | 待完善内容 |
|--------|------|----------|------------|
| 礼物赠送记录 | 🚫 | 暂不需要 | 系统无秀场直播 |
| 主播分成计算 | 🚫 | 暂不需要 | 系统无秀场直播 |

**优先级**: 🚫 暂不需要（系统无秀场直播功能）

---

## 五、数据与决策支持功能

### 14. 高级数据分析 (Advanced Analytics)

| 功能点 | 状态 | 当前实现 | 待完善内容 |
|--------|------|----------|------------|
| 基础报表 | ✅ | V2.1已有8个报表 | 功能完善 |
| 自定义报表 | ❌ | 无 | **待开发**: 运营可自定义统计维度 |
| 数据大屏 | ❌ | 无 | **可考虑**: 实时数据大屏展示 |
| 趋势预测 | ❌ | 无 | **可考虑**: 基于历史数据的趋势预测 |

**优先级**: 🔥 低

### 15. 智能推荐与预警 (Smart Alerts)

| 功能点 | 状态 | 当前实现 | 待完善内容 |
|--------|------|----------|------------|
| 风控预警 | ✅ | V2.1已有 | 可扩展 |
| 智能推荐 | ❌ | 无 | **可考虑**: 推荐需要关注的玩家/代理 |
| 异常检测 | ❌ | 无 | **可考虑**: AI检测异常投注模式 |

**优先级**: 🔥 低

---

## 六、开发优先级建议

### 🔥🔥🔥 P0 - 高优先级（核心运营效率）

**建议立即开发**:

1. **批量操作功能** (第1.1节)
   - 批量审核通过/拒绝
   - 批量启用/禁用
   - 预计开发时间：3-5天

2. **异常处理与补单** (第10.1节)
   - 改单/重结算
   - 手动作废局
   - 预计开发时间：5-7天

3. **视频回放系统** (第10.2节)
   - 局号级视频回放
   - 视频截图留证
   - 预计开发时间：7-10天（需视频存储方案）

4. **功能开关控制** (第5.3节)
   - 维护模式
   - 功能开关
   - 预计开发时间：2-3天

5. **操作日志完善** (第7节)
   - 操作日志查询界面
   - 数据变更对比
   - 预计开发时间：3-5天

---

### 🔥🔥 P1 - 中优先级（提升运营体验）

**建议规划开发**:

1. **批量导入/导出** (第1.3节)
   - Excel/CSV导入
   - 自定义字段导出
   - 预计开发时间：5-7天

2. **审核流优化** (第4节)
   - 拒绝原因模版
   - 历史比对
   - 预计开发时间：3-5天

3. **系统参数配置** (第5.2节)
   - 业务参数配置
   - 文案配置
   - 预计开发时间：3-4天

4. **荷官排班系统** (第10.3节)
   - 排班日历
   - 台桌绑定
   - 预计开发时间：7-10天

5. **实时路单监控** (第11.1节)
   - 路单展示
   - 杀率预警
   - 预计开发时间：5-7天

6. **交收报表** (第13.1节)
   - 荷官交收
   - 桌台盈亏
   - 预计开发时间：5-7天

---

### 🔥 P2 - 低优先级（长期优化）

**可根据实际需求决定**:

1. **高级筛选器** (第2.1节)
2. **用户视角模拟** (第3.2节)
3. **敏感操作增强** (第8节)
4. **数据权限隔离** (第9.1节)
5. **自定义报表** (第14节)

---

## 七、技术实现建议

### 1. 批量操作实现方案

**前端**:
```javascript
// 列表页增加批量选择
- 表头全选checkbox: <input type="checkbox" id="select-all">
- 每行选择checkbox: <input type="checkbox" class="row-select" value="{id}">
- 批量操作按钮栏: <div id="batch-actions" class="hidden">
    <button onclick="batchApprove()">批量通过</button>
    <button onclick="batchReject()">批量拒绝</button>
  </div>
```

**后端API**:
```typescript
// 批量更新API
app.put('/api/{module}/batch', async (c) => {
  const { ids, action, data } = await c.req.json()
  
  // 批量更新
  const stmt = db.prepare(`
    UPDATE {table} SET {field} = ? WHERE id IN (${ids.join(',')})
  `)
  
  // 审计日志
  for (const id of ids) {
    await logAudit(c, 'batch_update', id, data)
  }
  
  return c.json({ success: true, affected: ids.length })
})
```

---

### 2. 视频回放实现方案

**技术选型**:
- 视频存储：Cloudflare R2 或 AWS S3
- 视频切片：按局号（Round ID）存储视频切片
- 视频播放：使用 video.js 或 hls.js

**数据结构**:
```sql
CREATE TABLE game_rounds (
  id INTEGER PRIMARY KEY,
  round_id TEXT UNIQUE NOT NULL,  -- 局号
  table_id INTEGER,               -- 桌台ID
  dealer_id INTEGER,              -- 荷官ID
  video_url TEXT,                 -- 视频存储URL
  start_time DATETIME,
  end_time DATETIME,
  result TEXT,                    -- 开奖结果
  created_at DATETIME
);
```

---

### 3. 异常处理流程

**改单/重结算流程**:
```typescript
app.post('/api/rounds/:id/manual-settlement', async (c) => {
  const db = c.env.DB
  const roundId = c.req.param('id')
  const { new_result, reason, operator_id } = await c.req.json()
  
  try {
    // 1. 更新局结果
    await db.prepare(`
      UPDATE game_rounds SET 
        result = ?,
        manual_settled = 1,
        manual_reason = ?
      WHERE id = ?
    `).bind(new_result, reason, roundId).run()
    
    // 2. 查询该局所有注单
    const bets = await db.prepare(`
      SELECT * FROM bets WHERE round_id = ?
    `).bind(roundId).all()
    
    // 3. 重新计算每个注单的盈亏
    for (const bet of bets.results) {
      const new_payout = calculatePayout(bet, new_result)
      const diff = new_payout - bet.payout
      
      // 更新注单
      await db.prepare(`
        UPDATE bets SET 
          payout = ?,
          resettled = 1
        WHERE id = ?
      `).bind(new_payout, bet.id).run()
      
      // 更新玩家余额（多退少补）
      if (diff !== 0) {
        await db.prepare(`
          UPDATE players SET 
            balance = balance + ?
          WHERE id = ?
        `).bind(diff, bet.player_id).run()
        
        // 记录余额变动
        await db.prepare(`
          INSERT INTO transactions (player_id, type, amount, description)
          VALUES (?, 'manual_settlement', ?, ?)
        `).bind(bet.player_id, diff, `局号${roundId}重结算调整`).run()
      }
    }
    
    // 4. 审计日志
    await db.prepare(`
      INSERT INTO audit_logs (operator_id, action, target_type, target_id, description)
      VALUES (?, 'manual_settlement', 'round', ?, ?)
    `).bind(operator_id, roundId, `改单重结算: ${reason}`).run()
    
    return c.json({ 
      success: true, 
      message: '重结算完成',
      affected_bets: bets.results.length 
    })
  } catch (error) {
    return c.json({ success: false, error: String(error) }, 500)
  }
})
```

---

## 八、实施路线图

### 第一阶段（1-2周）：核心效率功能

**目标**: 提升日常运营效率

- [ ] 批量操作功能（批量审核、批量状态变更）
- [ ] 操作日志查询界面
- [ ] 功能开关控制
- [ ] 系统参数配置

**预计工作量**: 10-15人天

---

### 第二阶段（2-3周）：真人视讯核心功能

**目标**: 完善视讯系统特有功能

- [ ] 异常处理与补单系统
- [ ] 视频回放系统（需确定视频存储方案）
- [ ] 实时路单监控
- [ ] 套利检测增强

**预计工作量**: 20-25人天

---

### 第三阶段（2-3周）：运营流程优化

**目标**: 优化运营工作流

- [ ] 批量导入/导出
- [ ] 审核流优化（拒绝原因模版、历史比对）
- [ ] 荷官排班系统
- [ ] 交收报表

**预计工作量**: 20-25人天

---

### 第四阶段（长期迭代）：高级功能

**根据实际需求决定**:

- [ ] 高级筛选器
- [ ] 数据权限隔离
- [ ] 自定义报表
- [ ] 智能预警

---

## 九、成本估算

### 开发成本

| 阶段 | 功能模块 | 工作量 | 预计费用 |
|------|----------|--------|----------|
| 第一阶段 | 核心效率功能 | 15人天 | - |
| 第二阶段 | 视讯核心功能 | 25人天 | - |
| 第三阶段 | 运营流程优化 | 25人天 | - |
| **总计** | | **65人天** | **根据团队配置** |

### 基础设施成本

| 项目 | 描述 | 月费用 |
|------|------|--------|
| Cloudflare R2存储 | 视频回放存储 | $15/TB |
| 额外数据库空间 | D1数据库扩容 | 包含在Cloudflare Pages |
| CDN流量 | 视频回放流量 | 按使用量计费 |

---

## 十、风险与挑战

### 技术风险

1. **视频存储成本**
   - 挑战：视频文件占用存储空间大
   - 方案：设置保留期（如30天），过期自动删除
   
2. **视频回放性能**
   - 挑战：视频加载速度影响用户体验
   - 方案：使用CDN加速，分段存储

3. **批量操作性能**
   - 挑战：批量操作可能导致数据库阻塞
   - 方案：使用异步队列处理，显示处理进度

### 业务风险

1. **权限控制复杂度**
   - 挑战：细粒度权限控制增加系统复杂度
   - 方案：分阶段实现，先实现核心权限

2. **审计日志数据量**
   - 挑战：详细审计导致日志表膨胀
   - 方案：定期归档历史日志

---

## 十一、总结

### 当前系统强项

✅ **已具备的核心功能**:
1. 完整的玩家/代理管理
2. 财务管理（存款/提款/审核）
3. 红利与洗码配置（V2.1升级）
4. 风控管理（限红配置完善）
5. 8个核心报表
6. 基础审计日志
7. 角色权限管理

### 主要缺失功能

❌ **运营效率层面**:
- 批量操作（批量审核、批量状态变更、批量导入导出）
- 高级筛选（组合筛选、保存视图）
- 系统参数配置（避免硬编码）
- 功能开关控制

❌ **真人视讯核心**:
- 异常处理与补单（改单/重结算）
- 视频回放系统（局号级回放）
- 实时路单监控
- 荷官排班系统
- 交收报表（按班次/桌台）

❌ **安全与审计**:
- 操作日志查询界面
- 数据变更对比（before/after）
- 敏感操作增强保护

---

## 十二、决策建议

### 如果团队资源有限

**最小可行方案（MVP）**:

1. **必须开发**（2-3周）:
   - 批量操作（批量审核）
   - 功能开关控制
   - 操作日志查询界面
   
2. **真人视讯核心**（需外部依赖）:
   - 异常处理与补单（需确定视频存储方案）
   - 视频回放系统（需确定视频服务商）

### 如果资源充足

**完整实施路线图**（8-10周）:

- 第一阶段：核心效率功能（2周）
- 第二阶段：真人视讯核心（3周）
- 第三阶段：运营流程优化（3周）
- 第四阶段：持续迭代优化（长期）

---

## 附录：参考资料

- 《运营级管理后台（Admin Panel / CMS）》原文
- 《运营级真人视讯管理后台》原文
- 当前系统README.md
- 当前系统API文档

---

**文档创建**: 2025-12-01  
**作者**: AI Assistant (Claude Code)  
**联系方式**: cnwen123@gmail.com  
**GitHub**: https://github.com/CNWEN123/backstage-01A

---

© 2025 真人荷官视讯系统. All Rights Reserved.
